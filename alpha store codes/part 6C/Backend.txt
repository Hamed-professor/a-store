# ğŸ“ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Î‘ Store Backend

## ğŸ—‚ï¸ Ø³Ø§Ø®ØªØ§Ø± Ú©Ù„ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡

```
alpha-store-backend/
â”œâ”€â”€ ğŸ“ services/
â”‚   â”œâ”€â”€ ğŸ“ payments/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ zarinpalService.js
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ payirService.js
â”‚   â”‚   â””â”€â”€ ğŸ“„ nextpayService.js
â”‚   â”œâ”€â”€ ğŸ“ media/
â”‚   â”‚   â””â”€â”€ ğŸ“„ cloudinaryService.js
â”‚   â”œâ”€â”€ ğŸ“ notifications/
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ emailService.js
â”‚   â”‚   â””â”€â”€ ğŸ“„ smsService.js
â”‚   â””â”€â”€ ğŸ“ integration/
â”‚       â”œâ”€â”€ ğŸ“„ enamadService.js
â”‚       â”œâ”€â”€ ğŸ“„ postalService.js
â”‚       â””â”€â”€ ğŸ“„ currencyService.js
â”œâ”€â”€ ğŸ“ controllers/
â”‚   â”œâ”€â”€ ğŸ“„ paymentController.js
â”‚   â”œâ”€â”€ ğŸ“„ mediaController.js
â”‚   â”œâ”€â”€ ğŸ“„ documentController.js
â”‚   â””â”€â”€ ğŸ“„ integrationController.js
â”œâ”€â”€ ğŸ“ models/
â”‚   â”œâ”€â”€ ğŸ“„ Payment.js
â”‚   â””â”€â”€ ğŸ“„ Media.js
â”œâ”€â”€ ğŸ“ routes/
â”‚   â”œâ”€â”€ ğŸ“„ payments.js
â”‚   â”œâ”€â”€ ğŸ“„ media.js
â”‚   â”œâ”€â”€ ğŸ“„ documents.js
â”‚   â””â”€â”€ ğŸ“„ integration.js
â”œâ”€â”€ ğŸ“ middleware/
â”‚   â”œâ”€â”€ ğŸ“„ rateLimiter.js
â”‚   â””â”€â”€ ğŸ“„ validation.js
â”œâ”€â”€ ğŸ“ utils/
â”‚   â””â”€â”€ ğŸ“„ security.js
â”œâ”€â”€ ğŸ“ templates/
â”‚   â””â”€â”€ ğŸ“ email/
â”‚       â”œâ”€â”€ ğŸ“ fa/
â”‚       â”‚   â”œâ”€â”€ ğŸ“„ order-confirmation.html
â”‚       â”‚   â”œâ”€â”€ ğŸ“„ payment-receipt.html
â”‚       â”‚   â””â”€â”€ ğŸ“„ welcome.html
â”‚       â””â”€â”€ ğŸ“ en/
â”‚           â”œâ”€â”€ ğŸ“„ order-confirmation.html
â”‚           â”œâ”€â”€ ğŸ“„ payment-receipt.html
â”‚           â””â”€â”€ ğŸ“„ welcome.html
â”œâ”€â”€ ğŸ“„ app.js
â”œâ”€â”€ ğŸ“„ package.json
â””â”€â”€ ğŸ“„ .env
```

---

## ğŸš€ Ù…Ø±Ø§Ø­Ù„ Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ

### Ù…Ø±Ø­Ù„Ù‡ Û±: Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§

```bash
mkdir alpha-store-backend
cd alpha-store-backend

# Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
mkdir services controllers models routes middleware utils templates
mkdir services/payments services/media services/notifications services/integration
mkdir templates/email templates/email/fa templates/email/en
```

### Ù…Ø±Ø­Ù„Ù‡ Û²: Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§

```bash
npm init -y
npm install express mongoose axios cloudinary multer multer-storage-cloudinary
npm install nodemailer pdfkit bcryptjs jsonwebtoken express-rate-limit
npm install rate-limit-redis redis express-validator helmet xss cors dotenv
```

### Ù…Ø±Ø­Ù„Ù‡ Û³: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ

#### ğŸ“„ `package.json`
```json
{
  "name": "alpha-store-backend",
  "version": "1.0.0",
  "description": "Î‘ Store Backend APIs",
  "main": "app.js",
  "scripts": {
    "start": "node app.js",
    "dev": "nodemon app.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^7.5.0",
    "axios": "^1.5.0",
    "cloudinary": "^1.40.0",
    "multer": "^1.4.5-lts.1",
    "multer-storage-cloudinary": "^4.0.0",
    "nodemailer": "^6.9.4",
    "pdfkit": "^0.13.0",
    "bcryptjs": "^2.4.3",
    "jsonwebtoken": "^9.0.2",
    "express-rate-limit": "^6.10.0",
    "rate-limit-redis": "^3.0.1",
    "redis": "^4.6.8",
    "express-validator": "^7.0.1",
    "helmet": "^7.0.0",
    "xss": "^1.0.14",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}
```

#### ğŸ“„ `.env` (Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ)
```env
# Database
MONGODB_URI=mongodb://localhost:27017/alphastore

# JWT
JWT_SECRET=your_super_secure_jwt_secret_here

# Payment Gateways
ZARINPAL_MERCHANT_ID=your_zarinpal_merchant_id
ZARINPAL_WEBHOOK_SECRET=your_webhook_secret
PAYIR_API_KEY=your_payir_api_key
NEXTPAY_API_KEY=your_nextpay_api_key

# Cloudinary
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# Email Service
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASS=your_app_password
SMTP_FROM=noreply@alphastore.ir

# SMS Service
SMS_API_KEY=your_sms_api_key
SMS_USERNAME=your_sms_username
SMS_PASSWORD=your_sms_password
SMS_LINE_NUMBER=your_sms_line_number

# Other Services
ENAMAD_API_KEY=your_enamad_api_key
IRAN_POST_API_KEY=your_post_api_key
CURRENCY_API_KEY=your_currency_api_key

# Redis (Ø¨Ø±Ø§ÛŒ Rate Limiting)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# Frontend
FRONTEND_URL=http://localhost:3000

# Server
PORT=5000
NODE_ENV=development
```

#### ğŸ“„ `app.js` (ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø³Ø±ÙˆØ±)
```javascript
require('dotenv').config();
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const SecurityUtils = require('./utils/security');
const { apiLimiter } = require('./middleware/rateLimiter');

const app = express();

// Security middleware
app.use(SecurityUtils.configureSecurityHeaders());
app.use(cors({
  origin: process.env.FRONTEND_URL,
  credentials: true
}));

// Rate limiting
app.use('/api', apiLimiter);

// Body parsing
app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true }));

// Database connection
mongoose.connect(process.env.MONGODB_URI)
  .then(() => console.log('âœ… MongoDB connected'))
  .catch(err => console.error('âŒ MongoDB connection error:', err));

// Routes
app.use('/api/payments', require('./routes/payments'));
app.use('/api/media', require('./routes/media'));
app.use('/api/documents', require('./routes/documents'));
app.use('/api/integration', require('./routes/integration'));

// Health check
app.get('/api/health', (req, res) => {
  res.json({ 
    success: true, 
    message: 'Î‘ Store Backend is running!',
    timestamp: new Date().toISOString()
  });
});

// Error handling
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({
    success: false,
    message: 'Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±'
  });
});

// 404 handler
app.use('*', (req, res) => {
  res.status(404).json({
    success: false,
    message: 'Ù…Ø³ÛŒØ± ÛŒØ§ÙØª Ù†Ø´Ø¯'
  });
});

const PORT = process.env.PORT || 5000;
app.listen(PORT, () => {
  console.log(`ğŸš€ Server running on port ${PORT}`);
  console.log(`ğŸ“Š Environment: ${process.env.NODE_ENV}`);
});
```

---

## ğŸ“‹ Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ

### âœ… Ù…Ø±Ø­Ù„Ù‡ Û±: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
- [ ] `package.json` Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯
- [ ] `.env` Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø´Ø®ØµÛŒ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯  
- [ ] `app.js` Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯

### âœ… Ù…Ø±Ø­Ù„Ù‡ Û²: Services (Ø®Ø¯Ù…Ø§Øª)
Ø§Ø² artifact Ø§ØµÙ„ÛŒ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯:
- [ ] `services/payments/zarinpalService.js`
- [ ] `services/payments/payirService.js`
- [ ] `services/payments/nextpayService.js`
- [ ] `services/media/cloudinaryService.js`
- [ ] `services/notifications/emailService.js`
- [ ] `services/notifications/smsService.js`
- [ ] `services/integration/enamadService.js`
- [ ] `services/integration/postalService.js`
- [ ] `services/integration/currencyService.js`

### âœ… Ù…Ø±Ø­Ù„Ù‡ Û³: Controllers (Ú©Ù†ØªØ±Ù„Ø±Ù‡Ø§)
- [ ] `controllers/paymentController.js`
- [ ] `controllers/mediaController.js`
- [ ] `controllers/documentController.js`
- [ ] `controllers/integrationController.js`

### âœ… Ù…Ø±Ø­Ù„Ù‡ Û´: Models (Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³)
- [ ] `models/Payment.js`
- [ ] `models/Media.js`

### âœ… Ù…Ø±Ø­Ù„Ù‡ Ûµ: Routes (Ù…Ø³ÛŒØ±Ù‡Ø§)
- [ ] `routes/payments.js`
- [ ] `routes/media.js`
- [ ] `routes/documents.js`
- [ ] `routes/integration.js`

### âœ… Ù…Ø±Ø­Ù„Ù‡ Û¶: Middleware Ùˆ Utils
- [ ] `middleware/rateLimiter.js`
- [ ] `middleware/validation.js`
- [ ] `utils/security.js`

### âœ… Ù…Ø±Ø­Ù„Ù‡ Û·: Templates (Ù‚Ø§Ù„Ø¨â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ…ÛŒÙ„)
Ø³Ø§Ø¯Ù‡â€ŒØªØ±ÛŒÙ† Ù‚Ø§Ù„Ø¨â€ŒÙ‡Ø§:
- [ ] `templates/email/fa/order-confirmation.html`
- [ ] `templates/email/fa/payment-receipt.html`
- [ ] `templates/email/fa/welcome.html`

---

## ğŸ¯ Ø¯Ø³ØªÙˆØ±Ø§Øª Ø§Ø¬Ø±Ø§

```bash
# ØªÙˆØ³Ø¹Ù‡
npm run dev

# ØªÙˆÙ„ÛŒØ¯
npm start
```

---

## ğŸ”§ ØªØ³Øª Ú©Ø±Ø¯Ù† API Ù‡Ø§

### ØªØ³Øª Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆØ±:
```bash
curl http://localhost:5000/api/health
```

### ØªØ³Øª Ù¾Ø±Ø¯Ø§Ø®Øª:
```bash
curl -X POST http://localhost:5000/api/payments/request \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{"orderId": "ORDER_ID", "gateway": "zarinpal"}'
```

---

## â— Ù†Ú©Ø§Øª Ù…Ù‡Ù…

1. **Ø­ØªÙ…Ø§Ù‹ ÙØ§ÛŒÙ„ `.env` Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯** Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ§Ù‚Ø¹ÛŒ
2. **MongoDB** Ø¨Ø§ÛŒØ¯ Ø±ÙˆØ´Ù† Ø¨Ø§Ø´Ø¯
3. **Redis** Ø¨Ø±Ø§ÛŒ rate limiting (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
4. **ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ** Ø¨Ø±Ø§ÛŒ PDF Ù‡Ø§ Ø¯Ø± `assets/fonts/`
5. **SSL certificate** Ø¨Ø±Ø§ÛŒ production

---

## ğŸ†˜ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§

Ø§Ú¯Ø± Ø®Ø·Ø§ÛŒÛŒ Ø¯ÛŒØ¯ÛŒØ¯:
1. `npm install` Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯
2. `.env` Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯
3. MongoDB connection Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯
4. Port 5000 Ø¢Ø²Ø§Ø¯ Ø¨Ø§Ø´Ø¯

**Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø§Ø² artifact Ø§ØµÙ„ÛŒ Ù…Ù† Ù‚Ø§Ø¨Ù„ Ú©Ù¾ÛŒ Ù‡Ø³ØªÙ†Ø¯! ğŸš€**